# 备货

存在的必要性
---------------------------------------------------------------------------
最初的采购需求单不打算再提交核心物资 (微粉、破碎料、原生料)；新增的订单备货 (PurchasingPreparation) 数量不能更改，只能和订单数量保持一致；这两个情况放在一起就出现一个新的情况：如果订单中的数量小于供应商的最小起订量，那订单以外的部分由谁、通过什么途径提交？一个最典型的例子是：业务员下了 500 克拉某商品，该商品 1万克拉一包，供应商不单卖，最少采购1万克拉。订单中的 500 克拉走订单备货流程，那剩下的 9500 克拉由谁提交？让仓库提交的话，将来这些料卖不出去，找谁说理去？

基于以上场景，需要一个新的模型来承载这部分备货。

Hoard, MicroDiamondHoard, RvdHoard, DiamondHoard
---------------------------------------------------------------------------

- 采用和 Unit, MicroDiamondUnit 类似的共用主键的思路，核心模型 Hoard 仅存储名称、数量等共有的属性，具体每种商品单独建副模型，存储数据信息；

### 和 PlanItem 的关联

作为 PlanItem 新的类型，使用 `plan_item.hoard_id` 关联。目的在于采购计划审批时能一个页面显示所有内容；

Hoard 评审顺序：业务员 - 销售经理 - 备货采购员

评审通过后，将 PlanItem 状态更新为 CONFIRMED, 之后就是通用的询价流程；

### 避免和订单备货冲突

假设业务员先申请客户备货，后新建了一个订单。业务员自己清楚这个备货就是新建的订单所需的，但是仓库不知道，就会出现重复备货的情况。目前想到的办法是在订单备货页面，把相关的客户备货记录显示出来(9fe426a4)，提醒仓库核对。这只是权宜之机，应该有更好的办法。

DedicatedUnit
---------------------------------------------------------------------------

设计客户备货的初衷就是明确商品的责任。所以这类物资入库后需要进行限制，不能像普通物资那样随意取料。因此增加了“定向物资”的概念。

订单取料时对选择的物资增加一个判断：防止错误地使用定向物资。
