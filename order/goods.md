# 明细

模型
---------------------------------------------------------------------------

### Schema
Column                              | Type      | Null | Note
------------------------------------|-----------|------|-------
`id`                                | int       | No   | 
`grinding_paste_via`                | int       | Yes  | 研磨膏制作途径 Lookup: 自制和外协
`need_coat`                         | bool      | Yes  | 是否需要镀覆
`need_pick`                         | bool      | Yes  | 是否需要取料
`measurement_unit`                  | bool      | Yes  | 单位

部分列的说明：

- `measurement_unit`: 由于 product 表中 name 列使用的是 Lookup 记录，因此在 `Product::measurementUnitsMap()` 内定义了每种产品和对应单位的映射。**每当新增一个产品名称时，需要手动在映射中增加单位**;

### 研磨膏制作途径
由于历史原因,订单中研磨膏取料没有单独新建二次加工单，而是通过系统自动转换取料微粉的方式实现。外协研磨膏出现后，会以采购的形式直接采购研磨膏成品，这就导致一个问题：这些采购的研磨膏无法以订单取料的方式出库，只能盘出去。

基于此，需要新增一个记录制作途径的布尔列：`grinding_paste_via` 来解决此问题。需要说明的是，如果自制研磨膏能强制通过二次加工的形式体现，这一列完全不需要。

新建订单时，如果商品是研磨膏，则自动将该列的值设置成“自制”。仓库后期根据实际情况更改途径；该列对取料的“应取数量” (`pickableQuantity`)也有影响：外协时不需要单位转换，订货数量即应取数量；自制的应取数量会根据浓度折算；

操作
---------------------------------------------------------------------------

### 无需取料
对于一些无法取料的特殊情况，管理员可通过 `goods/toggle-pickness` 将订货明细设置为无需取料，从而跳过取料环节。
### 变更规格
`goods/substitute-product`. 一些特殊客户需要在评审通过后，更改商品规格，以便正确显示交付单内容。
### 取料入口
`goods/pick-portal`. 制品2部在订单明细的基础上的取料入口，可在此页面完成实际取料操作和订单备货两个操作。

### 关闭采购备货单价检查
`goods/turn-off-profit-check`. 订单备货询价和新建采购单时，会对采购价和关联的销售价进行比对，
防止出现采购价高于销售价的情况。部分特殊的订单会存在公司和业务员各出一半的情况，
此时订单中销售价的一半才是公司可承受的下限。此时就需要此操作将 `goods.profit_check_switch`
值设置为 0, 从而绕过检查。

`goods.profit_check_switch` 设置成 0 后，也会绕过新建采购单时的单价检查

评审顺序：采购员 → 采购主管


Change Logs
--------------------------------------------------------------------------
- 2025-11-27 Add 取料入口(`pick-portal`) 操作，制品2部在订单明细上取料的同时，还需要订单备货；
- 2025-10-22 Enh `Schema` 新增 `measurement_unit` 列，规范订单中货物的单位；
- 2025-02-06 Add 变更商品规格 (`substitute-product`)操作,应对特殊客户的需求；
- 2023-11-28 Enh `Schema` 新增 `need_coat` 布尔列，以订货明细为单位记录是否需要镀覆；
