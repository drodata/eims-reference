# 终止交付

对分批交付且已开始交付的订单，系统是禁止对订单做任何修改的。在实际场景中，由于各种原因，订单可能不再交付。一直以来这里采用的都是管理员手动修改的方式实现。这里有必要将此过程规范化、流程化。

逻辑要点
---------------------------------------------------------------------------

- 不支持用户自定义未交付数量。当前货物还未交付的数量，即要取消的数量；
- goods 表根据之前是否有交付记录分为两种情况：之前交付过，则仅调整数量，否则删除 goods 记录；
- `order_end_item.specification` 有一个额外验证：确保将要删除的记录上没有最终检验结果；
- 确定执行(`OrderEnd::apply()`)后，触发各个 handler 做如下事情：
    - 更新订单的状态和金额两列；
    - 更新订单关联的余额表数量；

评审
---------------------------------------------------------------------------
评审顺序：业务员、销售经理、仓库、生产主管。

